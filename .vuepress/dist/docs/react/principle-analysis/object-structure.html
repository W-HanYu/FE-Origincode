<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.60">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <title>高频对象 | Ustinian</title><meta name="description" content="react、vue主流框架源码的输出，包括原理解析以及框架中的算法以及面试频率很高的相关知识点，带你更深入的学习底层原理。">
    <link rel="modulepreload" href="/FE-Origincode/assets/app-f2c4a527.js"><link rel="modulepreload" href="/FE-Origincode/assets/framework-e1bed10d.js"><link rel="modulepreload" href="/FE-Origincode/assets/object-structure.html-3607d7cc.js"><link rel="modulepreload" href="/FE-Origincode/assets/fiber-hook-76f5316d.js"><link rel="modulepreload" href="/FE-Origincode/assets/object-structure.html-831fac88.js"><link rel="prefetch" href="/FE-Origincode/assets/index.html-6d5e9dd3.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-cd8c9a64.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-e901a9ed.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-e5e90244.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-06cde299.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-adbe0805.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-dd57d590.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-046de93b.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-6cf06f14.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-272107e1.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/guide.html-dec02f02.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/api.html-525462dc.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/home.html-f2247897.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/plugin.html-130a470f.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/theme.html-113726b9.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/121501.html-4be63e89.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/121501.html-b0306309.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/092101.html-7d9ce6d0.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/bitfield.html-05528e73.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/dfs.html-27a796e2.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/diff.html-4c99cb63.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/heapsort.html-b2adbf41.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/linkedlist.html-1e639661.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/stack.html-575417ff.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/092101.html-d9abbfc6.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/bootstrap.html-6869fd19.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/context.html-0d1c94bc.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/fibertree-commit.html-a02c0b97.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/fibertree-create.html-ac12eaf3.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/fibertree-prepare.html-c3de910a.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/fibertree-update.html-b91a5eb2.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/hook-effect.html-77b3b354.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/hook-state.html-54e4d6ec.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/hook-summary.html-677a2845.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/macro-structure.html-76e1ec09.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/priority.html-fd7b2162.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/reconciler-workflow.html-e5dbdca0.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/scheduler.html-611c1139.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/state-effects.html-618e8130.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/synthetic-event.html-2b0e06e6.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/workloop.html-cdf330af.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-660e4bef.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-c62ed802.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-40bced6f.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-ef51ba1b.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-d7e5408a.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-385dcb56.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-48e1c605.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-bdec80a5.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-3c78780e.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/index.html-47e4ee8b.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/guide.html-15eec75c.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/api.html-24420321.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/home.html-488bf774.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/plugin.html-e981e756.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/theme.html-034ac997.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/121501.html-e8542f91.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/121501.html-c9fc5001.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/092101.html-d894199d.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/bitfield.html-d56221bc.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/dfs.html-a38c7958.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/diff.html-1e9f68be.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/heapsort.html-5f570ec7.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/linkedlist.html-eda1cfe6.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/stack.html-b93207ae.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/092101.html-bd00ebb3.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/bootstrap.html-8d1e9840.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/context.html-52e26fbf.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/fibertree-commit.html-0fb065d5.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/fibertree-create.html-92509595.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/fibertree-prepare.html-bed44bc3.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/fibertree-update.html-8b9e8f16.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/hook-effect.html-d9a5b83a.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/hook-state.html-450521e3.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/hook-summary.html-9e07beb9.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/macro-structure.html-a095c7be.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/priority.html-3f6ab3ad.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/reconciler-workflow.html-5b5db7a6.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/scheduler.html-fbd5e5d7.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/state-effects.html-96c587f3.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/synthetic-event.html-c4067301.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/workloop.html-ae218d15.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/404.html-7c90b0cc.js" as="script"><link rel="prefetch" href="/FE-Origincode/assets/reco-valine-a0c1af1f.js" as="script">
    <link rel="preload" href="/FE-Origincode/assets/style-003d9841.css" as="style"><link rel="stylesheet" href="/FE-Origincode/assets/style-003d9841.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><div class="common-wrapper show-series show-catalog"><div><header class="navbar-container"><!--[--><div class="site-brand nav-item"><img class="logo" src="/FE-Origincode/logo.png" alt="Ustinian"><a href="/FE-Origincode/" class="site-name can-hide">Ustinian</a></div><div class="nav-item navbar-links-wrapper" style=""><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/FE-Origincode/" class="link router-link-active" aria-label="首页"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->首页<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="React"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->React<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="React"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->React<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/FE-Origincode/docs/react/principle-analysis/macro-structure" class="link" aria-label="原理篇"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->原理篇<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/FE-Origincode/docs/react/algorithm/diff" class="link" aria-label="算法篇"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->算法篇<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><a href="/FE-Origincode/tags/tag1/1/" class="link" aria-label="Vue"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Vue<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="小程序"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->小程序<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="小程序"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->小程序<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/FE-Origincode/docs/theme-reco/theme" class="link" aria-label="vuepress-reco"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->vuepress-reco<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/FE-Origincode/blogs/other/guide" class="link" aria-label="vuepress-theme-reco"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->vuepress-theme-reco<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><span class="xicon-container btn-toggle-dark-mode btn--dark-mode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:inherit;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:inherit;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div><!--]--></header><div class="mobile-menus-container"><nav class="navbar-links mobile"><!--[--><div class="navbar-links__item"><a href="/FE-Origincode/" class="link router-link-active" aria-label="首页"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->首页<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="React"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->React<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="React"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->React<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/FE-Origincode/docs/react/principle-analysis/macro-structure" class="link" aria-label="原理篇"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->原理篇<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/FE-Origincode/docs/react/algorithm/diff" class="link" aria-label="算法篇"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->算法篇<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-links__item"><a href="/FE-Origincode/tags/tag1/1/" class="link" aria-label="Vue"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Vue<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="小程序"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->小程序<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="小程序"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->小程序<!--]--></span></span></span><span class="right arrow"></span></button><ul style="display:none;" class="dropdown-link__container"><!--[--><li class="dropdown-link__item"><a href="/FE-Origincode/docs/theme-reco/theme" class="link" aria-label="vuepress-reco"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->vuepress-reco<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/FE-Origincode/blogs/other/guide" class="link" aria-label="vuepress-theme-reco"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->vuepress-theme-reco<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><div class="appearance"><span>Appearance</span><span class="xicon-container btn-toggle-dark-mode"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:inherit;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span></div></div><div class="series-mask"></div><aside class="series-container"><div class="site-brand"><img class="logo" src="/FE-Origincode/logo.png" alt="Ustinian"><a href="/FE-Origincode/" class="site-name can-hide">Ustinian</a></div><!--[--><!--[--><section class="series-group series-item"><h5 class="series-heading active">基础概念</h5><ul><li><!--[--><a href="/FE-Origincode/docs/react/principle-analysis/macro-structure.html" class="link series-item" aria-label="宏观包结构"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->宏观包结构<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/FE-Origincode/docs/react/principle-analysis/workloop.html" class="link series-item" aria-label="两大工作循环"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->两大工作循环<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a aria-current="page" href="/FE-Origincode/docs/react/principle-analysis/object-structure.html" class="router-link-active router-link-exact-active link router-link-active series-item active" aria-label="高频对象"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->高频对象<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading">运行核心</h5><ul><li><!--[--><a href="/FE-Origincode/docs/react/principle-analysis/bootstrap.html" class="link series-item" aria-label="启动过程"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->启动过程<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/FE-Origincode/docs/react/principle-analysis/reconciler-workflow.html" class="link series-item" aria-label="reconciler 运作流程"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->reconciler 运作流程<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/FE-Origincode/docs/react/principle-analysis/priority.html" class="link series-item" aria-label="优先级管理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->优先级管理<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/FE-Origincode/docs/react/principle-analysis/scheduler.html" class="link series-item" aria-label="调度原理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->调度原理<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/FE-Origincode/docs/react/principle-analysis/fibertree-prepare.html" class="link series-item" aria-label="fiber 树构造(基础准备)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->fiber 树构造(基础准备)<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/FE-Origincode/docs/react/principle-analysis/fibertree-create.html" class="link series-item" aria-label="fiber 树构造(初次创建)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->fiber 树构造(初次创建)<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/FE-Origincode/docs/react/principle-analysis/fibertree-update.html" class="link series-item" aria-label="fiber 树构造(对比更新)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->fiber 树构造(对比更新)<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/FE-Origincode/docs/react/principle-analysis/fibertree-commit.html" class="link series-item" aria-label="fiber 树渲染"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->fiber 树渲染<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--[--><section class="series-group series-item"><h5 class="series-heading">状态管理</h5><ul><li><!--[--><a href="/FE-Origincode/docs/react/principle-analysis/state-effects.html" class="link series-item" aria-label="状态与副作用"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->状态与副作用<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/FE-Origincode/docs/react/principle-analysis/hook-summary.html" class="link series-item" aria-label="Hook 原理(概览)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Hook 原理(概览)<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/FE-Origincode/docs/react/principle-analysis/hook-state.html" class="link series-item" aria-label="Hook 原理(状态Hook)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Hook 原理(状态Hook)<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/FE-Origincode/docs/react/principle-analysis/hook-effect.html" class="link series-item" aria-label="Hook 原理(副作用Hook)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Hook 原理(副作用Hook)<!--]--></span></span><!--[--><!--]--></a><!--]--></li><li><!--[--><a href="/FE-Origincode/docs/react/principle-analysis/context.html" class="link series-item" aria-label="context 原理"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->context 原理<!--]--></span></span><!--[--><!--]--></a><!--]--></li></ul></section><!--]--><!--]--></aside><!--[--><main class="page-container"><h1 class="page-title">高频对象</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->wangtao<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:inherit;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->2023/06/10<!--]--></span></span><!----><!----><!----></div><div class="theme-reco-default-content"><div><h1 id="react-应用中的高频对象" tabindex="-1"><a class="header-anchor" href="#react-应用中的高频对象" aria-hidden="true">#</a> React 应用中的高频对象</h1><p>在 React 应用中, 有很多特定的对象或数据结构. 了解这些内部的设计, 可以更容易理解 react 运行原理. 本章主要列举从 react 启动到渲染过程出现频率较高, 影响范围较大的对象, 它们贯穿整个 react 运行时.</p><p>其他过程的重要对象:</p><ul><li>如<code>事件对象</code>(位于<code>react-dom/events</code>保障 react 应用能够响应 ui 交互), 在事件机制章节中详细解读.</li><li>如<code>ReactContext, ReactProvider, ReactConsumer</code>对象, 在 context 机制章节中详细解读.</li></ul><h2 id="react-包" tabindex="-1"><a class="header-anchor" href="#react-包" aria-hidden="true">#</a> react 包</h2><p>在<a href="/FE-Origincode/docs/react/principle-analysis/macro-structure.html" class="">React 应用的宏观包结构</a>中介绍过, 此包定义 react 组件(<code>ReactElement</code>)的必要函数, 提供一些操作<code>ReactElement</code>对象的 api.</p><p>所以这个包的核心需要理解<code>ReactElement</code>对象, 假设有如下入口函数:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 入口函数</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>可以简单的认为, 包括<code>&lt;App/&gt;</code>及其所有子节点都是<code>ReactElement</code>对象(在 render 之后才会生成子节点, 后文详细解读), 每个<code>ReactElement</code>对象的区别在于 type 不同.</p><h3 id="reactelement-对象" tabindex="-1"><a class="header-anchor" href="#reactelement-对象" aria-hidden="true">#</a> <a href="https://github.com/facebook/react/blob/v17.0.2/packages/react/src/ReactElement.js#L126-L146" target="_blank" rel="noopener noreferrer">ReactElement 对象<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><blockquote><p>其 type 定义在<a href="https://github.com/facebook/react/blob/v17.0.2/packages/shared/ReactElementType.js#L15" target="_blank" rel="noopener noreferrer"><code>shared</code>包中<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p></blockquote><p>所有采用<code>jsx</code>语法书写的节点, 都会被编译器转换, 最终会以<code>React.createElement(...)</code>的方式, 创建出来一个与之对应的<code>ReactElement</code>对象.</p><p><code>ReactElement</code>对象的数据结构如下:</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ReactElement</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">|</span>
  <span class="token comment">// 用于辨别ReactElement对象</span>
  $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>

  <span class="token comment">// 内部属性</span>
  type<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token comment">// 表明其种类</span>
  key<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
  ref<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>

  <span class="token comment">// ReactFiber 记录创建本对象的Fiber节点, 还未与Fiber树关联之前, 该属性为null</span>
  _owner<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>

  <span class="token comment">// __DEV__ dev环境下的一些额外信息, 如文件路径, 文件名, 行列信息等</span>
  _store<span class="token operator">:</span> <span class="token punctuation">{</span>validated<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  _self<span class="token operator">:</span> React$Element<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  _shadowChildren<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
  _source<span class="token operator">:</span> Source<span class="token punctuation">,</span>
<span class="token operator">|</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>需要特别注意 2 个属性:</p><ol><li><p><code>key</code>属性在<code>reconciler</code>阶段会用到, 目前只需要知道所有的<code>ReactElement</code>对象都有 key 属性(且<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react/src/ReactElement.js#L348-L357" target="_blank" rel="noopener noreferrer">其默认值是 null<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, 这点十分重要, 在 diff 算法中会使用到).</p></li><li><p><code>type</code>属性决定了节点的种类:</p></li></ol><ul><li>它的值可以是字符串(代表<code>div,span</code>等 dom 节点), 函数(代表<code>function, class</code>等节点), 或者 react 内部定义的节点类型(<code>portal,context,fragment</code>等)</li><li>在<code>reconciler</code>阶段, 会根据 type 执行不同的逻辑(在 fiber 构建阶段详细解读). <ul><li>如 type 是一个字符串类型, 则直接使用.</li><li>如 type 是一个<code>ReactComponent</code>类型, 则会调用其 render 方法获取子节点.</li><li>如 type 是一个<code>function</code>类型,则会调用该方法获取子节点</li><li>...</li></ul></li></ul><p>在<code>v17.0.2</code>中, <a href="https://github.com/facebook/react/blob/v17.0.2/packages/shared/ReactSymbols.js#L16-L37" target="_blank" rel="noopener noreferrer">定义了 20 种<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>内部节点类型. 根据运行时环境不同, 分别采用 16 进制的字面量和<code>Symbol</code>进行表示.</p><h3 id="reactcomponent对象" tabindex="-1"><a class="header-anchor" href="#reactcomponent对象" aria-hidden="true">#</a> <a href="https://github.com/facebook/react/blob/v17.0.2/packages/react/src/ReactBaseClasses.js#L20-L30" target="_blank" rel="noopener noreferrer">ReactComponent<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>对象</h3><p>对于<code>ReactElement</code>来讲, <code>ReactComponent</code>仅仅是诸多<code>type</code>类型中的一种.</p><p>对于开发者来讲, <code>ReactComponent</code>使用非常高频(在状态组件章节中详细解读), 在本节只是先证明它只是一种特殊的<code>ReactElement</code>.</p><p>这里用一个简单的示例, 通过查看编译后的代码来说明</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>header<span class="token operator">&gt;</span>header<span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Content <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>footer<span class="token operator">&gt;</span>footer<span class="token operator">&lt;</span><span class="token operator">/</span>footer<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Content</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>React<span class="token punctuation">.</span>Fragment<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token number">3</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>Fragment<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编译之后的代码(此处只编译了 jsx 语法, 并没有将 class 语法编译成 es5 中的 function), 可以更直观的看出调用逻辑.</p><p><code>createElement</code>函数的第一个参数将作为创建<code>ReactElement</code>的<code>type</code>. 可以看到<code>Content</code>这个变量被编译器命名为<code>App_Content</code>, 并作为第一个参数(引用传递), 传入了<code>createElement</code>.</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">App_App</span> <span class="token keyword">extends</span> <span class="token class-name">react_default<span class="token punctuation">.</span>a<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token comment">/*#__PURE__*/</span> react_default<span class="token punctuation">.</span>a<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>
      <span class="token string">&#39;div&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">className</span><span class="token operator">:</span> <span class="token string">&#39;app&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span> <span class="token comment">/*#__PURE__*/</span><span class="token punctuation">,</span>
      react_default<span class="token punctuation">.</span>a<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;header&#39;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&#39;header&#39;</span><span class="token punctuation">)</span> <span class="token comment">/*#__PURE__*/</span><span class="token punctuation">,</span>

      <span class="token comment">// 此处直接将Content传入, 是一个指针传递</span>
      react_default<span class="token punctuation">.</span>a<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>App_Content<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">/*#__PURE__*/</span><span class="token punctuation">,</span>
      react_default<span class="token punctuation">.</span>a<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;footer&#39;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&#39;footer&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">App_Content</span> <span class="token keyword">extends</span> <span class="token class-name">react_default<span class="token punctuation">.</span>a<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token comment">/*#__PURE__*/</span> react_default<span class="token punctuation">.</span>a<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>
      react_default<span class="token punctuation">.</span>a<span class="token punctuation">.</span>Fragment<span class="token punctuation">,</span>
      <span class="token keyword">null</span> <span class="token comment">/*#__PURE__*/</span><span class="token punctuation">,</span>
      react_default<span class="token punctuation">.</span>a<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;p&#39;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">/*#__PURE__*/</span>

      react_default<span class="token punctuation">.</span>a<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;p&#39;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&#39;2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">/*#__PURE__*/</span>

      react_default<span class="token punctuation">.</span>a<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;p&#39;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&#39;3&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上述示例演示了<code>ReactComponent</code>是诸多<code>ReactElement</code>种类中的一种情况, 但是由于<code>ReactComponent</code>是 class 类型, 自有它的特殊性(可<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react/src/ReactBaseClasses.js" target="_blank" rel="noopener noreferrer">对照源码<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, 更容易理解).</p><ol><li><code>ReactComponent</code>是 class 类型, 继承父类<code>Component</code>, 拥有特殊的方法(<code>setState</code>,<code>forceUpdate</code>)和特殊的属性(<code>context</code>,<code>updater</code>等).</li><li>在<code>reconciler</code>阶段, 会依据<code>ReactElement</code>对象的特征, 生成对应的 fiber 节点. 当识别到<code>ReactElement</code>对象是 class 类型的时候, 会触发<code>ReactComponent</code>对象的生命周期, 并调用其 <code>render</code>方法, 生成<code>ReactElement</code>子节点.</li></ol><h3 id="其他reactelement" tabindex="-1"><a class="header-anchor" href="#其他reactelement" aria-hidden="true">#</a> 其他<code>ReactElement</code></h3><p>上文介绍了第一种特殊的<code>ReactElement</code>(<code>class</code>类型的组件), 除此之外<code>function</code>类型的组件也需要深入了解, 因为<code>Hook</code>只能在<code>function</code>类型的组件中使用.</p><p>如果在<code>function</code>类型的组件中没有使用<code>Hook</code>(如: <code>useState</code>, <code>useEffect</code>等), 在<code>reconciler</code>阶段所有有关<code>Hook</code>的处理都会略过, 最后调用该<code>function</code>拿到子节点<code>ReactElement</code>.</p><p>如果使用了<code>Hook</code>, 逻辑就相对复杂, 涉及到<code>Hook</code>创建和状态保存(有关 Hook 的原理部分, 在 Hook 原理章节中详细解读). 此处只需要了解<code>function</code>类型的组件和<code>class</code>类型的组件一样, 是诸多<code>ReactElement</code>形式中的一种.</p><h3 id="reactelement内存结构" tabindex="-1"><a class="header-anchor" href="#reactelement内存结构" aria-hidden="true">#</a> <code>ReactElement</code>内存结构</h3><p>通过前文对<code>ReactElement</code>的介绍, 可以比较容易的画出<code>&lt;App/&gt;</code>这个<code>ReactElement</code>对象在内存中的结构(<code>reconciler</code>阶段完成之后才会形成完整的结构).</p><img src="/FE-Origincode/assets/reactelement-tree-31f3f88b.png" width="600"><p>注意:</p><ul><li><code>class</code>和<code>function</code>类型的组件,其子节点是在 render 之后(<code>reconciler</code>阶段)才生成的. 此处只是单独表示<code>ReactElement</code>的数据结构.</li><li>父级对象和子级对象之间是通过<code>props.children</code>属性进行关联的(与 fiber 树不同).</li><li><code>ReactElement</code>虽然不能算是一个严格的树, 也不能算是一个严格的链表. 它的生成过程是自顶向下的, 是所有组件节点的总和.</li><li><code>ReactElement</code>树(暂且用树来表述)和<code>fiber</code>树是以<code>props.children</code>为单位<code>先后交替</code>生成的(在 fiber 树构建章节详细解读), 当<code>ReactElement</code>树构造完毕, fiber 树也随后构造完毕.</li><li><code>reconciler</code>阶段会根据<code>ReactElement</code>的类型生成对应的<code>fiber</code>节点(不是一一对应, 比如<code>Fragment</code>类型的组件在生成<code>fiber</code>节点的时候会略过).</li></ul><h2 id="react-reconciler-包" tabindex="-1"><a class="header-anchor" href="#react-reconciler-包" aria-hidden="true">#</a> <code>react-reconciler</code> 包</h2><p>在<a href="/FE-Origincode/docs/react/principle-analysis/macro-structure.html" class="">宏观结构</a>中介绍过, <code>react-reconciler</code>包是<code>react</code>应用的中枢, 连接渲染器(<code>react-dom</code>)和调度中心(<code>scheduler</code>), 同时自身也负责 fiber 树的构造.</p><p>对于此包的深入分析, 放在<code>fiber 树构建</code>, <code>reconciler 工作空间</code>等章节中.</p><p>此处先要知道<code>fiber</code>是核心, react 体系的渲染和更新都要以 fiber 作为数据模型, 如果不能理解 fiber, 也无法深入理解 react.</p><p>本章先预览一下此包中与<code>fiber</code>对象关联度较高的对象.</p><h3 id="fiber-对象" tabindex="-1"><a class="header-anchor" href="#fiber-对象" aria-hidden="true">#</a> Fiber 对象</h3><p>先看数据结构, 其 type 类型的定义在<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactInternalTypes.js#L47-L174" target="_blank" rel="noopener noreferrer"><code>ReactInternalTypes.js</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 一个Fiber对象代表一个即将渲染或者已经渲染的组件(ReactElement), 一个组件可能对应两个fiber(current和WorkInProgress)</span>
<span class="token comment">// 单个属性的解释在后文(在注释中无法添加超链接)</span>
<span class="token keyword">export</span> type Fiber <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">|</span>
  <span class="token literal-property property">tag</span><span class="token operator">:</span> WorkTag<span class="token punctuation">,</span>
  <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token operator">|</span> string<span class="token punctuation">,</span>
  <span class="token literal-property property">elementType</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  <span class="token literal-property property">stateNode</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  <span class="token keyword">return</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">child</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">sibling</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> number<span class="token punctuation">,</span>
  <span class="token literal-property property">ref</span><span class="token operator">:</span>
    <span class="token operator">|</span> <span class="token keyword">null</span>
    <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">handle</span><span class="token operator">:</span> mixed</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">{</span> <span class="token literal-property property">_stringRef</span><span class="token operator">:</span> <span class="token operator">?</span>string<span class="token punctuation">,</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">|</span> RefObject<span class="token punctuation">,</span>
  <span class="token literal-property property">pendingProps</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token comment">// 从`ReactElement`对象传入的 props. 用于和`fiber.memoizedProps`比较可以得出属性是否变动</span>
  <span class="token literal-property property">memoizedProps</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token comment">// 上一次生成子节点时用到的属性, 生成子节点之后保持在内存中</span>
  <span class="token literal-property property">updateQueue</span><span class="token operator">:</span> mixed<span class="token punctuation">,</span> <span class="token comment">// 存储state更新的队列, 当前节点的state改动之后, 都会创建一个update对象添加到这个队列中.</span>
  <span class="token literal-property property">memoizedState</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token comment">// 用于输出的state, 最终渲染所使用的state</span>
  <span class="token literal-property property">dependencies</span><span class="token operator">:</span> Dependencies <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 该fiber节点所依赖的(contexts, events)等</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> TypeOfMode<span class="token punctuation">,</span> <span class="token comment">// 二进制位Bitfield,继承至父节点,影响本fiber节点及其子树中所有节点. 与react应用的运行模式有关(有ConcurrentMode, BlockingMode, NoMode等选项).</span>

  <span class="token comment">// Effect 副作用相关</span>
  <span class="token literal-property property">flags</span><span class="token operator">:</span> Flags<span class="token punctuation">,</span> <span class="token comment">// 标志位</span>
  <span class="token literal-property property">subtreeFlags</span><span class="token operator">:</span> Flags<span class="token punctuation">,</span> <span class="token comment">//替代16.x版本中的 firstEffect, nextEffect. 当设置了 enableNewReconciler=true才会启用</span>
  <span class="token literal-property property">deletions</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>Fiber<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 存储将要被删除的子节点. 当设置了 enableNewReconciler=true才会启用</span>

  <span class="token literal-property property">nextEffect</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 单向链表, 指向下一个有副作用的fiber节点</span>
  <span class="token literal-property property">firstEffect</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 指向副作用链表中的第一个fiber节点</span>
  <span class="token literal-property property">lastEffect</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 指向副作用链表中的最后一个fiber节点</span>

  <span class="token comment">// 优先级相关</span>
  <span class="token literal-property property">lanes</span><span class="token operator">:</span> Lanes<span class="token punctuation">,</span> <span class="token comment">// 本fiber节点的优先级</span>
  <span class="token literal-property property">childLanes</span><span class="token operator">:</span> Lanes<span class="token punctuation">,</span> <span class="token comment">// 子节点的优先级</span>
  <span class="token literal-property property">alternate</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 指向内存中的另一个fiber, 每个被更新过fiber节点在内存中都是成对出现(current和workInProgress)</span>

  <span class="token comment">// 性能统计相关(开启enableProfilerTimer后才会统计)</span>
  <span class="token comment">// react-dev-tool会根据这些时间统计来评估性能</span>
  actualDuration<span class="token operator">?</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// 本次更新过程, 本节点以及子树所消耗的总时间</span>
  actualStartTime<span class="token operator">?</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// 标记本fiber节点开始构建的时间</span>
  selfBaseDuration<span class="token operator">?</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// 用于最近一次生成本fiber节点所消耗的时间</span>
  treeBaseDuration<span class="token operator">?</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// 生成子树所消耗的时间的总和</span>
<span class="token operator">|</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性解释:</p><ul><li><code>fiber.tag</code>: 表示 fiber 类型, 根据<code>ReactElement</code>组件的 type 进行生成, 在 react 内部共定义了<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactWorkTags.js#L10-L35" target="_blank" rel="noopener noreferrer">25 种 tag<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li><code>fiber.key</code>: 和<code>ReactElement</code>组件的 key 一致.</li><li><code>fiber.elementType</code>: 一般来讲和<code>ReactElement</code>组件的 type 一致</li><li><code>fiber.type</code>: 一般来讲和<code>fiber.elementType</code>一致. 一些特殊情形下, 比如在开发环境下为了兼容热更新(<code>HotReloading</code>), 会对<code>function, class, ForwardRef</code>类型的<code>ReactElement</code>做一定的处理, 这种情况会区别于<code>fiber.elementType</code>, 具体赋值关系可以查看<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiber.old.js#L571-L574" target="_blank" rel="noopener noreferrer">源文件<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li><code>fiber.stateNode</code>: 与<code>fiber</code>关联的局部状态节点(比如: <code>HostComponent</code>类型指向与<code>fiber</code>节点对应的 dom 节点; 根节点<code>fiber.stateNode</code>指向的是<code>FiberRoot</code>; class 类型节点其<code>stateNode</code>指向的是 class 实例).</li><li><code>fiber.return</code>: 指向父节点.</li><li><code>fiber.child</code>: 指向第一个子节点.</li><li><code>fiber.sibling</code>: 指向下一个兄弟节点.</li><li><code>fiber.index</code>: fiber 在兄弟节点中的索引, 如果是单节点默认为 0.</li><li><code>fiber.ref</code>: 指向在<code>ReactElement</code>组件上设置的 ref(<code>string</code>类型的<code>ref</code>除外, 这种类型的<code>ref</code>已经不推荐使用, <code>reconciler</code>阶段会将<code>string</code>类型的<code>ref</code>转换成一个<code>function</code>类型).</li><li><code>fiber.pendingProps</code>: 输入属性, 从<code>ReactElement</code>对象传入的 props. 用于和<code>fiber.memoizedProps</code>比较可以得出属性是否变动.</li><li><code>fiber.memoizedProps</code>: 上一次生成子节点时用到的属性, 生成子节点之后保持在内存中. 向下生成子节点之前叫做<code>pendingProps</code>, 生成子节点之后会把<code>pendingProps</code>赋值给<code>memoizedProps</code>用于下一次比较.<code>pendingProps</code>和<code>memoizedProps</code>比较可以得出属性是否变动.</li><li><code>fiber.updateQueue</code>: 存储<code>update更新对象</code>的队列, 每一次发起更新, 都需要在该队列上创建一个<code>update对象</code>.</li><li><code>fiber.memoizedState</code>: 上一次生成子节点之后保持在内存中的局部状态.</li><li><code>fiber.dependencies</code>: 该 fiber 节点所依赖的(contexts, events)等, 在<code>context</code>机制章节详细说明.</li><li><code>fiber.mode</code>: 二进制位 Bitfield,继承至父节点,影响本 fiber 节点及其子树中所有节点. 与 react 应用的运行模式有关(有 ConcurrentMode, BlockingMode, NoMode 等选项).</li><li><code>fiber.flags</code>: 标志位, 副作用标记(在 16.x 版本中叫做<code>effectTag</code>, 相应<a href="https://github.com/facebook/react/pull/19755" target="_blank" rel="noopener noreferrer">pr<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>), 在<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberFlags.js#L10-L41" target="_blank" rel="noopener noreferrer"><code>ReactFiberFlags.js</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中定义了所有的标志位. <code>reconciler</code>阶段会将所有拥有<code>flags</code>标记的节点添加到副作用链表中, 等待 commit 阶段的处理.</li><li><code>fiber.subtreeFlags</code>: 替代 16.x 版本中的 firstEffect, nextEffect. 默认未开启, 当设置了<a href="https://github.com/facebook/react/blob/v17.0.2/packages/shared/ReactFeatureFlags.js#L93" target="_blank" rel="noopener noreferrer">enableNewReconciler=true<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 才会启用, 本系列只跟踪稳定版的代码, 未来版本不会深入解读, <a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberCompleteWork.new.js#L690-L714" target="_blank" rel="noopener noreferrer">使用示例见源码<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li><code>fiber.deletions</code>: 存储将要被删除的子节点. 默认未开启, 当设置了<a href="https://github.com/facebook/react/blob/v17.0.2/packages/shared/ReactFeatureFlags.js#L93" target="_blank" rel="noopener noreferrer">enableNewReconciler=true<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 才会启用, 本系列只跟踪稳定版的代码, 未来版本不会深入解读, <a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactChildFiber.new.js#L275-L287" target="_blank" rel="noopener noreferrer">使用示例见源码<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li><code>fiber.nextEffect</code>: 单向链表, 指向下一个有副作用的 fiber 节点.</li><li><code>fiber.firstEffect</code>: 指向副作用链表中的第一个 fiber 节点.</li><li><code>fiber.lastEffect</code>: 指向副作用链表中的最后一个 fiber 节点.</li><li><code>fiber.lanes</code>: 本 fiber 节点所属的优先级, 创建 fiber 的时候设置.</li><li><code>fiber.childLanes</code>: 子节点所属的优先级.</li><li><code>fiber.alternate</code>: 指向内存中的另一个 fiber, 每个被更新过 fiber 节点在内存中都是成对出现(current 和 workInProgress)</li></ul><p>通过以上 25 个属性的解释, 对<code>fiber</code>对象有一个初步的认识.</p><p>最后绘制一颗 fiber 树与上文中的<code>ReactElement</code>树对照起来:</p><div><img src="/FE-Origincode/assets/reactelement-tree-31f3f88b.png" alt="reactelement" width="500"><img src="/FE-Origincode/assets/fiber-tree-55e5b7a9.png" alt="fiber" width="500"></div> 注意: <ul><li>这里的<code>fiber</code>树只是为了和上文中的<code>ReactElement</code>树对照, 所以只用观察红色虚线框内的节点. 根节点<code>HostRootFiber</code>在<a href="/FE-Origincode/docs/react/principle-analysis/bootstrap.html" class="">react 应用的启动模式章节中</a>详细解读.</li><li>其中<code>&lt;App/&gt;</code>,<code>&lt;Content/&gt;</code>为<code>ClassComponent</code>类型的<code>fiber</code>节点, 其余节点都是普通<code>HostComponent</code>类型节点.</li><li><code>&lt;Content/&gt;</code>的子节点在<code>ReactElement</code>树中是<code>React.Fragment</code>, 但是在<code>fiber</code>树中<code>React.Fragment</code>并没有与之对应的<code>fiber</code>节点(<code>reconciler</code>阶段对此类型节点做了单独处理, 所以<code>ReactElement</code>节点和<code>fiber</code>节点不是一对一匹配).</li></ul><h3 id="update-与-updatequeue-对象" tabindex="-1"><a class="header-anchor" href="#update-与-updatequeue-对象" aria-hidden="true">#</a> Update 与 UpdateQueue 对象</h3><p>在<code>fiber</code>对象中有一个属性<code>fiber.updateQueue</code>, 是一个链式队列(即使用链表实现的队列存储结构), 后文会根据场景表述成链表或队列.</p><p>首先观察<code>Update</code>对象的数据结构(<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactUpdateQueue.old.js#L106-L129" target="_blank" rel="noopener noreferrer">对照源码<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>):</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> type Update<span class="token operator">&lt;</span>State<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">|</span>
  <span class="token literal-property property">eventTime</span><span class="token operator">:</span> number<span class="token punctuation">,</span> <span class="token comment">// 发起update事件的时间(17.0.2中作为临时字段, 即将移出)</span>
  <span class="token literal-property property">lane</span><span class="token operator">:</span> Lane<span class="token punctuation">,</span> <span class="token comment">// update所属的优先级</span>

  <span class="token literal-property property">tag</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token operator">|</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token number">2</span> <span class="token operator">|</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">//</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token comment">// 载荷, 根据场景可以设置成一个回调函数或者对象</span>
  <span class="token literal-property property">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> mixed<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 回调函数</span>

  <span class="token literal-property property">next</span><span class="token operator">:</span> Update<span class="token operator">&lt;</span>State<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 指向链表中的下一个, 由于UpdateQueue是一个环形链表, 最后一个update.next指向第一个update对象</span>
<span class="token operator">|</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// =============== UpdateQueue ==============</span>
type SharedQueue<span class="token operator">&lt;</span>State<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">|</span>
  <span class="token literal-property property">pending</span><span class="token operator">:</span> Update<span class="token operator">&lt;</span>State<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token operator">|</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> type UpdateQueue<span class="token operator">&lt;</span>State<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">|</span>
  <span class="token literal-property property">baseState</span><span class="token operator">:</span> State<span class="token punctuation">,</span>
  <span class="token literal-property property">firstBaseUpdate</span><span class="token operator">:</span> Update<span class="token operator">&lt;</span>State<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">lastBaseUpdate</span><span class="token operator">:</span> Update<span class="token operator">&lt;</span>State<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">shared</span><span class="token operator">:</span> SharedQueue<span class="token operator">&lt;</span>State<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">effects</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>Update<span class="token operator">&lt;</span>State<span class="token operator">&gt;&gt;</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token operator">|</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性解释:</p><ol><li><p><code>UpdateQueue</code></p><ul><li><code>baseState</code>: 表示此队列的基础 state</li><li><code>firstBaseUpdate</code>: 指向基础队列的队首</li><li><code>lastBaseUpdate</code>: 指向基础队列的队尾</li><li><code>shared</code>: 共享队列</li><li><code>effects</code>: 用于保存有<code>callback</code>回调函数的 update 对象, 在<code>commit</code>之后, 会依次调用这里的回调函数.</li></ul></li><li><p><code>SharedQueue</code></p><ul><li><code>pending</code>: 指向即将输入的<code>update</code>队列. 在<code>class</code>组件中调用<code>setState()</code>之后, 会将新的 update 对象添加到这个队列中来.</li></ul></li><li><p><code>Update</code></p><ul><li><code>eventTime</code>: 发起<code>update</code>事件的时间(17.0.2 中作为临时字段, 即将移出)</li><li><code>lane</code>: <code>update</code>所属的优先级</li><li><code>tag</code>: 表示<code>update</code>种类, 共 4 种. <a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactUpdateQueue.old.js#L131-L134" target="_blank" rel="noopener noreferrer"><code>UpdateState,ReplaceState,ForceUpdate,CaptureUpdate</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><code>payload</code>: 载荷, <code>update</code>对象真正需要更新的数据, 可以设置成一个回调函数或者对象.</li><li><code>callback</code>: 回调函数. <code>commit</code>完成之后会调用.</li><li><code>next</code>: 指向链表中的下一个, 由于<code>UpdateQueue</code>是一个环形链表, 最后一个<code>update.next</code>指向第一个<code>update</code>对象.</li></ul></li></ol><p><code>updateQueue</code>是<code>fiber</code>对象的一个属性, 所以不能脱离<code>fiber</code>存在. 它们之间数据结构和引用关系如下:</p><p><img src="/FE-Origincode/assets/updatequeue-de304be7.png" alt=""></p><p>注意:</p><ul><li>此处只是展示数据结构和引用关系.对于<code>updateQueue</code>在更新阶段的实际作用和运行逻辑, 会在状态组件(class 与 function)章节中详细解读.</li></ul><h3 id="hook-对象" tabindex="-1"><a class="header-anchor" href="#hook-对象" aria-hidden="true">#</a> Hook 对象</h3><p><code>Hook</code>用于<code>function</code>组件中, 能够保持<code>function</code>组件的状态(与<code>class</code>组件中的<code>state</code>在性质上是相同的, 都是为了保持组件的状态).在<code>react@16.8</code>以后, 官方开始推荐使用<code>Hook</code>语法, 常用的 api 有<code>useState</code>,<code>useEffect</code>,<code>useCallback</code>等, 官方一共定义了<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberHooks.old.js#L111-L125" target="_blank" rel="noopener noreferrer">14 种<code>Hook</code>类型<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>这些 api 背后都会创建一个<code>Hook</code>对象, 先观察<a href="https://github.com/facebook/react/blob/v17.0.2/packages/react-reconciler/src/ReactFiberHooks.old.js#L134-L140" target="_blank" rel="noopener noreferrer"><code>Hook</code>对象的数据结构<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> type Hook <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">|</span>
  <span class="token literal-property property">memoizedState</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  <span class="token literal-property property">baseState</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  <span class="token literal-property property">baseQueue</span><span class="token operator">:</span> Update<span class="token operator">&lt;</span>any<span class="token punctuation">,</span> any<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">queue</span><span class="token operator">:</span> UpdateQueue<span class="token operator">&lt;</span>any<span class="token punctuation">,</span> any<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">next</span><span class="token operator">:</span> Hook <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token operator">|</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

type Update<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">|</span>
  <span class="token literal-property property">lane</span><span class="token operator">:</span> Lane<span class="token punctuation">,</span>
  <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eagerReducer</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">S</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eagerState</span><span class="token operator">:</span> <span class="token constant">S</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">next</span><span class="token operator">:</span> Update<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
  priority<span class="token operator">?</span><span class="token operator">:</span> ReactPriorityLevel<span class="token punctuation">,</span>
<span class="token operator">|</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

type UpdateQueue<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">|</span>
  <span class="token literal-property property">pending</span><span class="token operator">:</span> Update<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span><span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">dispatch</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> mixed<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">lastRenderedReducer</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">S</span><span class="token punctuation">,</span> <span class="token constant">A</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">S</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token literal-property property">lastRenderedState</span><span class="token operator">:</span> <span class="token constant">S</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token operator">|</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性解释:</p><ol><li><code>Hook</code></li></ol><ul><li><code>memoizedState</code>: 内存状态, 用于输出成最终的<code>fiber</code>树</li><li><code>baseState</code>: 基础状态, 当<code>Hook.queue</code>更新过后, <code>baseState</code>也会更新.</li><li><code>baseQueue</code>: 基础状态队列, 在<code>reconciler</code>阶段会辅助状态合并.</li><li><code>queue</code>: 指向一个<code>Update</code>队列</li><li><code>next</code>: 指向该<code>function</code>组件的下一个<code>Hook</code>对象, 使得多个<code>Hook</code>之间也构成了一个链表.</li></ul><ol start="2"><li><code>Hook.queue</code>和 <code>Hook.baseQueue</code>(即<code>UpdateQueue</code>和<code>Update</code>）是为了保证<code>Hook</code>对象能够顺利更新, 与上文<code>fiber.updateQueue</code>中的<code>UpdateQueue和Update</code>是不一样的(且它们在不同的文件), 其逻辑会在状态组件(class 与 function)章节中详细解读.</li></ol><p><code>Hook</code>与<code>fiber</code>的关系:</p><p>在<code>fiber</code>对象中有一个属性<code>fiber.memoizedState</code>指向<code>fiber</code>节点的内存状态. 在<code>function</code>类型的组件中, <code>fiber.memoizedState</code>就指向<code>Hook</code>队列(<code>Hook</code>队列保存了<code>function</code>类型的组件状态).</p><p>所以<code>Hook</code>也不能脱离<code>fiber</code>而存在, 它们之间的引用关系如下:</p><p><img src="/FE-Origincode/assets/fiber-hook-76e7a801.png" alt=""></p><p>注意:</p><ul><li>此处只是展示数据结构和引用关系.对于<code>Hook</code>在运行时的实际作用和逻辑, 会在状态组件(class 与 function)章节中详细解读.</li></ul><h2 id="scheduler-包" tabindex="-1"><a class="header-anchor" href="#scheduler-包" aria-hidden="true">#</a> scheduler 包</h2><p>如<a href="/FE-Origincode/docs/react/principle-analysis/macro-structure.html" class="">宏观结构</a>中所介绍, <code>scheduler</code>包负责调度, 在内部维护一个任务队列(<a href="https://github.com/facebook/react/blob/v17.0.2/packages/scheduler/src/Scheduler.js#L63" target="_blank" rel="noopener noreferrer">taskQueue<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>). 这个队列是一个最小堆数组(详见<a href="/FE-Origincode/docs/react/algorithm/heapsort.html" class="">React 算法之堆排序</a>), 其中存储了 task 对象.</p><h3 id="task-对象" tabindex="-1"><a class="header-anchor" href="#task-对象" aria-hidden="true">#</a> Task 对象</h3><p><code>scheduler</code>包中, 没有为 task 对象定义 type, 其<a href="https://github.com/facebook/react/blob/v17.0.2/packages/scheduler/src/Scheduler.js#L316-L326" target="_blank" rel="noopener noreferrer">定义是直接在 js 代码<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> newTask <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> taskIdCounter<span class="token operator">++</span><span class="token punctuation">,</span>
  callback<span class="token punctuation">,</span>
  priorityLevel<span class="token punctuation">,</span>
  startTime<span class="token punctuation">,</span>
  expirationTime<span class="token punctuation">,</span>
  <span class="token literal-property property">sortIndex</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>属性解释:</p><ul><li><code>id</code>: 唯一标识</li><li><code>callback</code>: task 最核心的字段, 指向<code>react-reconciler</code>包所提供的回调函数.</li><li><code>priorityLevel</code>: 优先级</li><li><code>startTime</code>: 一个时间戳,代表 task 的开始时间(创建时间 + 延时时间).</li><li><code>expirationTime</code>: 过期时间.</li><li><code>sortIndex</code>: 控制 task 在队列中的次序, 值越小的越靠前.</li></ul><p>注意<code>task</code>中没有<code>next</code>属性, 它不是一个链表, 其顺序是通过堆排序来实现的(小顶堆数组, 始终保证数组中的第一个<code>task</code>对象优先级最高).</p><p><img src="/FE-Origincode/assets/taskqueue-dad49db7.png" alt=""></p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>本章主要浏览了 react 运行链路中出现的高频对象, 并对它们的数据结构做出了单独解释. 提前了解这些对象的数据结构, 更加有利于之后对 react 源码的深入分析. 在后续对整个运行核心的解读中会多次引用到这些对象, 并对其在运行时的具体作用深入解读.</p></div></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:inherit;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Last Updated 2023-06-10 06:43:09<!--]--></span></span></div></footer><nav class="page-nav"><p class="hasPrev inner"><span class="page-nav-item prev"> ← 两大工作循环</span><!----></p></nav><!----></main><!--]--><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/FE-Origincode/docs/react/principle-analysis/object-structure.html#react-包" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="react 包"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->react 包<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/FE-Origincode/docs/react/principle-analysis/object-structure.html#reactelement-对象" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="ReactElement 对象"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->ReactElement 对象<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/FE-Origincode/docs/react/principle-analysis/object-structure.html#reactcomponent对象" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="ReactComponent对象"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->ReactComponent对象<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/FE-Origincode/docs/react/principle-analysis/object-structure.html#其他reactelement" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="其他ReactElement"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->其他ReactElement<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/FE-Origincode/docs/react/principle-analysis/object-structure.html#reactelement内存结构" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="ReactElement内存结构"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->ReactElement内存结构<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/FE-Origincode/docs/react/principle-analysis/object-structure.html#react-reconciler-包" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="react-reconciler 包"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->react-reconciler 包<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/FE-Origincode/docs/react/principle-analysis/object-structure.html#fiber-对象" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="Fiber 对象"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Fiber 对象<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/FE-Origincode/docs/react/principle-analysis/object-structure.html#update-与-updatequeue-对象" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="Update 与 UpdateQueue 对象"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Update 与 UpdateQueue 对象<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/FE-Origincode/docs/react/principle-analysis/object-structure.html#hook-对象" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="Hook 对象"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Hook 对象<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/FE-Origincode/docs/react/principle-analysis/object-structure.html#scheduler-包" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="scheduler 包"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->scheduler 包<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/FE-Origincode/docs/react/principle-analysis/object-structure.html#task-对象" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="Task 对象"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->Task 对象<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/FE-Origincode/docs/react/principle-analysis/object-structure.html#总结" class="router-link-active router-link-exact-active link page-catalog-item" aria-label="总结"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:inherit;font-size:14px;"><!--[-->总结<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--></ul></div></div></div></div><!----><!----><!--]--></div>
    <script type="module" src="/FE-Origincode/assets/app-f2c4a527.js" defer></script>
  </body>
</html>
